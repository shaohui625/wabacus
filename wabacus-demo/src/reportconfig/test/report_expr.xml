<?xml version="1.0" encoding="UTF-8"?>
<applications xmlns="http://www.wabacus.com"
					xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
					xsi:schemaLocation="http://www.wabacus.com ../xsd/wabacus.applications.xsd">

	<local-resources>
    	<resources>
     	   	<resource key ="pOptions" type=" com.wabacus.config.resource.OptionRes"> 
 		    <options>
	 					<option value="优秀" label="优秀" />
						<option value="良好" label="良好" />
						<option value="较好" label="较好" />
						<option value="很差" label="很差" />
		    </options>
	     </resource>
	     
	      	<resource key ="pOptions1" type="com.wabacus.extra.options.StringSplitOptionRes"  separator="[,;  　]"> 
	      	优秀,良好,较好,很差
	      	</resource>
	      	
	      <resource key ="pOptions2" type="com.wabacus.extra.options.MvelTextOptionRes" > 
	     ['优秀':1,'良好':2,'较好':3,'很差':4]
	      	</resource>
	      	<resource key ="pOptions3" type="com.wabacus.extra.options.MvelTextOptionRes" > 
	     	 {'优秀','良好','较好','很差'}
	      	</resource>
	      	<resource key ="pOptions4" type="com.wabacus.extra.options.MvelTextOptionRes" > 
	    '优秀,良好,较好,很差'.split(',')
	      	</resource>
	      <resource key ="pOptions5" type="com.wabacus.extra.options.YamlTextOptionRes" > 
	     {优秀 : 1, 良好 : 2, 较好 : 3, 很差 : 4}
	      	</resource>
	      	
	 </resources>
</local-resources>
	<!-- 数据编辑篇报表类型  -->
	<page id="test103" js="/webresources/script/validate.js"  data-write-roles="ROLE_SYS_ADMIN" data-read-roles="ROLE_USER">
	<!-- 
	 <interceptor>
	  		  <imports>
	  	 		   <import>com.wabacus.util.*</import>	
	  	 	  </imports>
	  	 	  <preaction>
	  	 		//rrequest.authorize("report1",null,null,"display","false");//将report1报表设置为不显示
	  	 		//rrequest.authorize("report2",null,null,"readonly","true");//将report2报表设置为只读
	  	 		//rrequest.authorize("report3",null,null,"disabled","true");//将report3报表设置为禁用
	  	 		rrequest.authorize("test102",null,null,"disabled","true");
	  	 	</preaction>
	  	 </interceptor>
	  
	   -->
	  	<tabpanel id="tp1" titlestyle="2" margin="10px" titlewidth="120px" >
	  
	  		<report id="report1" title="部门信息列表" parenttitle="编辑方式一" type="editablelist2"   dataexport="richexcel|plainexcel|word"
				 pk="guid"	 pojoTabname="tbl_department"
				 >
			<display>
						<col column="guid" property="guid"  displaytype="hidden" pk="true"  idGenerator="UUID" />
						<col column="deptno" label="部门编号" clickorderby="true" valuestyleproperty="style='mso-number-format:\@'">
							<inputbox jsvalidate="isNotEmpty({0}列不允许为空)"/>
						</col>
						<col column="deptname" label="部门名" clickorderby="true"/>
						<col column="manager" label="部门经理"/>
						<col column="builtdate" label="创建日期" clickorderby="true" datatype="date{yyyy-MM-dd}">
							<inputbox type="datepicker"  jsvalidate="isDate({0}格式不对，必须为yyyy-MM-dd格式)"/>
						</col>
						<col column="performance" label="表现" clickorderby="true" filter="true" >
							<inputbox type="selectbox">
									<option source="${pOptions}"/>
									<option value="" label="无" />
							</inputbox>
						</col>
	
						
					</display>
					<sql datasource="ds_expr">
					  <select>
						<value>
							<![CDATA[
								@code{
										tabname ="tbl_department";
										orderBy = [ "guid":-1   ]
								}
								var queryMap = this.getQueryConditionMap();
								findAsList(queryMap,tabname);
							]]>
						</value>
						<condition name="txtdeptno" label="部门编号"  >
							<value>
								<![CDATA[
									newQuery().regex("deptno",data)
								]]>
							</value>
							<inputbox>
								<typeprompt width="200" count="15">
									<promptcol label="deptno" matchmode="anywhere"/>
<!-- 									<datasource>findTypePrompts(newQuery().regex("deptno",data).toMap(),tabname,typeObj)</datasource> -->
									
									
										<datasource>
								<option source='@{findTypePrompts(newQuery().regex("deptno",data).toMap(),tabname,typeObj)}'/>
							</datasource>
								</typeprompt>
							</inputbox>
						</condition>
					  </select>
<!-- 
	insert(attrs(["deptno","deptname","manager","builtdate","performance","description"]))
	insert(newAttrsBuilder(true).remove(["guid"]))
	insert(newAttrsBuilder(true).remove("guid"))
	
		insert("guid")
		
 -->
				<insert confirmessage="您确认要'保存'吗?" >
					insert()
				</insert>
				<!-- 
						update(attrs(["guid"]),attrs(["guid","deptno","deptname","manager","builtdate","performance","description"]))
						update("guid")
				 -->
				<update confirmessage="您确认要'保存'吗?" >
					update()
				</update>
				<!-- 
						delete(attrs(["guid"]));
						delete("guid");
				 -->
				<delete  confirmessage="您确认要'删除'吗?" >
						delete();
				</delete>
				</sql>
			</report>
			
			
						<report id="report2" title="部门信息列表２" parenttitle="默认编辑列"  extends="test103.report1"   type="editablelist"  dataexport="richexcel|plainexcel|word"
						
									data-write-roles="ROLE_SYS_ADMIN1" 
	
						>


	<display>
						<col column="guid" property="guid"  displaytype="hidden" pk="true"  idGenerator="UUID" />
						<col column="deptno" label="部门编号" clickorderby="true" valuestyleproperty="style='mso-number-format:\@'">
							<inputbox jsvalidate="isNotEmpty({0}列不允许为空)"/>
						</col>
						<col column="deptname" label="部门名" clickorderby="true"/>
						<col column="manager" label="部门经理"/>
						<col column="builtdate" label="创建日期" clickorderby="true" datatype="date{yyyy-MM-dd}">
							<inputbox type="datepicker"  jsvalidate="isDate({0}格式不对，必须为yyyy-MM-dd格式)"/>
						</col>
						<col column="performance" label="表现" clickorderby="true" filter="true" >
							<inputbox type="selectbox">
									<option source="${pOptions}"/>
									<option value="" label="无" />
							</inputbox>
						</col>
						

					</display>
					
					
					<sql datasource="ds_expr">
					
						  <select>
						<value>
							<![CDATA[
								@code{
										tabname ="tbl_department";
										orderBy = [ "guid":-1   ]
								}
								var queryMap = this.getQueryConditionMap();
								findAsList(queryMap,tabname);
							]]>
						</value>
						<condition name="txtdeptno" label="部门编号"  >
							<value>
								<![CDATA[
									newQuery().regex("deptno",data)
								]]>
							</value>
					<inputbox>

							<typeprompt width="200" count="15">
									<promptcol label="deptno" matchmode="anywhere"/>
									<!-- <datasource>findTypePrompts(newQuery().regex("deptno",data).toMap(),"tbl_department",typeObj)</datasource> -->
										<datasource>
								<option source='@{findTypePrompts(newQuery().regex("deptno",data).toMap(),"tbl_department",typeObj)}'/>
							</datasource>
							</typeprompt>

							</inputbox>
						</condition>
					  </select>
					  <insert pageurl="report{editforlistpageTest103_1.report1}" pagewidth="650" pageheight="400" pagemaxbtn="true" pageminbtn="true"/>
					  <update pageurl="report{editforlistpageTest103_1.report1}"  urlparams="txtdeptno=@{guid}" pagewidth="650" pageheight="400" pageinitsize="max" pagemaxbtn="true" pageminbtn="true"/>
				<delete  confirmessage="您确认要'删除'吗?" >
						delete(attrs(["deptno"]));
				</delete>
					</sql>
				</report>
	  	</tabpanel>
	  	
				<footer>
				<![CDATA[
					<br><font color="red">说明：</font><font color="blue">这里演示“添加”时以默认窗口打开；“修改”时以最大化窗口打开</font>
				]]>
				</footer>

	</page>

<page id="editforlistpageTest103_1" js="/webresources/script/validate.js">
	<!-- 
 <interceptor>
	  		  <imports>
	  	 		   <import>com.wabacus.util.*</import>	
	  	 	  </imports>
	  	 	  <preaction>
	  	 		//rrequest.authorize("report1",null,null,"display","false");//将report1报表设置为不显示
	  	 		//rrequest.authorize("report2",null,null,"readonly","true");//将report2报表设置为只读
	  	 		//rrequest.authorize("report3",null,null,"disabled","true");//将report3报表设置为禁用
	  	 		rrequest.authorize("report1",null,null,"readonly","true");
	  	 	</preaction>
	  	 </interceptor>
	  	  -->
		<report id="report1" title="request{dept_name}详细资料" type="editabledetail"  pojoTabname="tbl_department">
			<display valuetdwidth="100px" labeltdwidth="71px"
				labelbgcolor="#f0f0f0" labelalign="right" valuealign="left">
				<col column="guid" property="guid" displaytype="hidden"  pk="true"  idGenerator="UUID"/>
				<col column="deptno" label="部门编号" valuestyleproperty="style='mso-number-format:\@'">
					<inputbox jsvalidate="isNotEmpty({0}列不允许为空)" />
				</col>
				<col column="deptname" label="部门名" br="true" />
				<col column="manager" label="部门经理" />
				<col column="builtdate" label="创建日期" datatype="date{yyyy-MM-dd}"
					br="true">
					<inputbox type="datepicker" jsvalidate="isDate({0}格式不对，必须为yyyy-MM-dd格式)" />
				</col>
				<col column="performance" label="表现" valuestyleproperty="colspan='3'"
					br="true">
					<inputbox type="selectbox">
						<option source="${pOptions}"/>
						<option value="" label="无" />
					</inputbox>
				</col>
				<col column="description" label="简介" datatype="clob"
					valuestyleproperty="colspan='3'">
					<inputbox type="textareabox" styleproperty="rows='5'" />
				</col>
			</display>
			<sql datasource="ds_expr">
				<select>
					<value>
					<![CDATA[
						@code{tabname ="tbl_department";}
						var queryMap = this.getQueryConditionMap();
						assertNotEmpty(queryMap,"请输入ID");
						findAsList(queryMap,tabname);
					]]>
				</value>
					<condition name="txtdeptno"  hidden="true">
						<value>
						<![CDATA[
							 ["guid":data]
						]]>
						</value>
					</condition>
				</select>
				<!--  insert(attrs(["guid","deptno","deptname","manager","builtdate","performance","description"])) -->
				<insert>
					insert();
				</insert>
				<update>
					update(attrs(["guid"]),attrs(["guid","deptno","deptname","manager","builtdate","performance","description"]))
				</update>
			</sql>
			<format>
				<value>
					rrequest.getRequest().setAttribute("dept_name",deptname);//存放request，以便显示标题时能取到
				</value>
			</format>
		</report>
	</page>

<!--
	<page id="test101">
		<tabpanel id="tp1" margin="10px" titlestyle="2">
			<report id="report1" title="员工信息列表" parenttitle="普通数据列表报表" dataexport="richexcel|word" >
				<display>
					<col column="{sequence:1}" label="序号"/>
					<col column="no" label="工号" clickorderby="true" valuestyleproperty="style='mso-number-format:\@' width='15%'"/>
					<col column="name" label="姓名" clickorderby="true" width="15%"/>
					<group label="基本信息">
						<col column="sex" label="性别"/>
						<col column="age" label="年龄" clickorderby="true" filter="true" filterwidth="120px"/>
						<col column="birthday" label="出生日期" clickorderby="true" displaytype="always"/>
					</group>
					<col column="deptname" label="所属部门" filter="true" filterwidth="120px"/>
				</display>
				<sql type="mvel">
					<value>
						<![CDATA[
							SELECT no,name,sex,age,birthday,deptname FROM tbl_baseinfo A left join tbl_department B on A.deptno=B.deptno where  {#condition#} order by no

						]]>
					</value>
					<condition name="txtno" label="工号">
						<value>
							<![CDATA[(no like  '%#data#%' )]]>
						</value>
					</condition>
					<condition name="txtname" label="姓名">
						<value>
							<![CDATA[(name like  '%#data#%' )]]>
						</value>
					</condition>
					<condition name="txtsex" label="性别">
						<value>
							<![CDATA[(sex =#data#)]]>
						</value>
						<inputbox type="selectbox">
							<option value="" label="性别"/>
							<option value="1" label="男"/>
							<option value="0" label="女" />
						</inputbox>
					</condition>
				</sql>
				<format>
				  <value>
						sex=sex==null?"1":sex.trim();
						if(sex.equals("0")) sex="女";
						else sex="男";
						birthday=birthday==null?"":birthday.trim();
						int idx=birthday.indexOf(" ");//判断是否有时间，有的话就去掉时间，只显示日期
						if(idx>0) birthday=birthday.substring(0,idx);
				  </value>
				</format>
			</report>

		</tabpanel>
	</page>




	 <page id="test104">
		<report id="report104" title="员工信息列表"   type="editablelist2"  dataexport="richexcel|word">
			<display>
				<col column="id" label="序号1" clickorderby="true"  valuestyleproperty="style='mso-number-format:\@' width='8%'"/>
				<col column="assessUnit" label="考核公司" clickorderby="true" width="15%">
						<inputbox>
							 <typeprompt count="15"   >
							<promptcol label="assessUnit"  matchmode="2"/>
							<datasource>select distinct assessUnit from PFMA_MARKTYPE_CONFIG where  ASSESSUNIT like '%#data#%'</datasource>
						  </typeprompt>
						</inputbox>
				</col>
				<group label="考核时间">
					<col column="year" label="年度" clickorderby="true" filter="true" filterwidth="120px" >

								<inputbox type="selectbox">
						<option value="2012" label="2012年"/>
						<option value="2013"  label="2013年"/>

					</inputbox>
					</col>
					<col column="peroid" label="周期"  displaytype="always"  filter="true" >
						<inputbox type="selectbox">
						<option value="0" label="年 度"/>
						<option value="1" label="1 月"/>
						<option value="2" label="2 月"/>
						<option value="3" label="3 月"/>
						<option value="4" label="4 月"/>
						<option value="5" label="5 月"/>
						<option value="6" label="6 月"/>
						<option value="7" label="7 月"/>
						<option value="8" label="8 月"/>
						<option value="9" label="9 月"/>
						<option value="10" label="10 月"/>
						<option value="11" label="11 月"/>
						<option value="12" label="12 月"/>

						<option value="15" label="每 月"/>

						<option value="21" label="第1季"/>
						<option value="22" label="第2季"/>
						<option value="23" label="第3季"/>
						<option value="24" label="第4季"/>
						<option value="25" label="每 季"/>
					</inputbox>
					</col>
				</group>
					<col column="assessor" label="考核方" filter="true" filterwidth="120px">
							<inputbox>
							 <typeprompt count="15"   >
							<promptcol label="assessor"  matchmode="anywhere"/>
							<datasource>select distinct assessor from PFMA_MARKTYPE_CONFIG where  assessor like '%#data#%'</datasource>
						  </typeprompt>
						</inputbox>
					</col>
				<col column="target" label="被考核方" filter="true" filterwidth="120px">
								<inputbox>
							 <typeprompt count="15"   >
							<promptcol label="target"  matchmode="2"/>
							<datasource>select distinct target from PFMA_MARKTYPE_CONFIG where  target like '%#data#%'</datasource>
						  </typeprompt>
						</inputbox>
				</col>

				<col column="markType"  label="打分类型" filter="true" filterwidth="120px">
						<inputbox type="selectbox">
							<option label="请选择" value=""/>
							<option source="@{ select code ,name from PFMA_CODE_TABLE}" label="name" value="code"/>
						</inputbox>
				</col>

			</display>
			<sql datasource="ds_spring">
				  <select>
				<value>
					<![CDATA[
    select       "ID",      "ASSESSUNIT",      "ASSESSOR",   "PEROID",     markType, "TARGET",  YEAR
    from    "PFMA_MARKTYPE_CONFIG" where  {#condition#} order by ID

]]>
				</value>
				<condition name="txtno" label="考核方">
					<value>
						<![CDATA[(assessor like  '%#data#%' )]]>
					</value>
				</condition>
				<condition name="txtname" label="考核公司">
					<value>
						<![CDATA[(assessUnit like  '%#data#%' )]]>
					</value>
				</condition>
				<condition name="txtyear" label="年度">
					<value>
						<![CDATA[(year =#data#)]]>
					</value>
					<inputbox type="selectbox">
						<option value="2012" label="2012年"/>
						<option value="2013"  label="2013年"/>
						<option value="" label=" 全 部 "/>

					</inputbox>
				</condition>
				<condition name="txtperoid" label="周期">
					<value>
						<![CDATA[(peroid =#data#)]]>
					</value>
					<inputbox type="selectbox">
						<option value="0" label="年 度"/>
						<option value="1" label="1 月"/>
						<option value="2" label="2 月"/>
						<option value="3" label="3 月"/>
						<option value="4" label="4 月"/>
						<option value="5" label="5 月"/>
						<option value="6" label="6 月"/>
						<option value="7" label="7 月"/>
						<option value="8" label="8 月"/>
						<option value="9" label="9 月"/>
						<option value="10" label="10 月"/>
						<option value="11" label="11 月"/>
						<option value="12" label="12 月"/>

						<option value="15" label="每 月"/>

						<option value="21" label="第1季"/>
						<option value="22" label="第2季"/>
						<option value="23" label="第3季"/>
						<option value="24" label="第4季"/>
						<option value="25" label="每 季"/>
						<option value="" label="全 部"/>
					</inputbox>
				</condition>

				</select>
				  <insert confirmessage="您确认要进行'保存'操作吗">
				 		 <external-values>
				 		 	<value name="SEQ" value="sequence{SEQ_PFMA_MARKTYPE_CONFIG}"/>
				 		 </external-values>
			  		 <value>insert into PFMA_MARKTYPE_CONFIG(id=#{SEQ},@{assessUnit},@{target},@{assessor},@{year},@{peroid},@{markType});

			  		 </value>
				  </insert>
				  <update confirmessage="您确认要进行'保存'操作吗">
				     update PFMA_MARKTYPE_CONFIG(@{assessUnit},@{target},@{assessor},@{year},@{peroid},@{markType}) where id=@{id};
				  </update>
				  <delete confirmessage="您确认要进行'删除'操作吗">
				  	 delete from PFMA_MARKTYPE_CONFIG where where id=@{id};
				  </delete>

			</sql>
			<format>
			  <value>

			  </value>
			</format>
		</report>
	</page> -->
</applications>